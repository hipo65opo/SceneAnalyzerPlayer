# SceneAnalyzer 操作マニュアル

## 概要

SceneAnalyzerは、動画ファイルからシーンを自動検出し、各シーンの内容をAIで解析するアプリケーションです。検出されたシーンには自動的にタグ付けが行われ、動画内の特定のシーンを素早く見つけることができます。

## システム要件

- Windows 10以降
- 最小解像度: 1280x720
- 推奨: 4GB以上のRAM、マルチコアCPU
- インターネット接続（AIによるシーン解析に必要）

## 対応ファイル形式

- 現在のバージョンでは、H.264コーデックを使用したMP4ファイル（.mp4）のみをサポートしています。
- その他の動画形式やコーデックは、将来のバージョンでサポート予定です。

## 初期設定

### APIキーの設定

1. アプリケーションを起動後、メニューバーから「ヘルプ」→「設定...」を選択します。
2. 「API設定」タブを選択します。
3. Google Gemini APIキーを入力します。
   - APIキーをお持ちでない場合は、[Google AI Studio](https://aistudio.google.com/)からAPIキーを取得してください。
4. 「保存」ボタンをクリックして設定を保存します。

## 基本操作

### 動画の読み込み

1. 「ファイル」→「動画を開く...」を選択するか、メインウィンドウの「開く」ボタンをクリックします。
2. 動画ファイルを選択して「開く」をクリックします。（対応形式: H.264コーデックのMP4ファイル）
3. 動画がメインプレーヤーに読み込まれます。

### 動画の再生操作

- **再生/一時停止**: 中央の再生/一時停止ボタンをクリックします。
- **停止**: 停止ボタンをクリックすると、動画が最初に戻ります。
- **シークバー**: 動画内の特定の位置に移動するには、シークバーをドラッグします。
- **音量調整**: 音量スライダーを使用して音量を調整します。
- **再生速度**: 再生速度ドロップダウンから速度を選択します（0.5x～2.0x）。
- **ループ再生**: ループ再生チェックボックスをオンにすると、動画が繰り返し再生されます。

### シーン検出と解析

1. 動画を読み込んだ後、「シーン検出解析」ボタンをクリックします。
2. セッション作成ダイアログが表示されます：
   - **セッション名**: 任意のセッション名を入力します。
   - **検出設定**: シーン検出の閾値と最小シーン長を設定します。
   - **解析設定**: APIキーとプロンプトを確認します。
3. 「OK」をクリックしてシーン検出を開始します。
4. シーン検出が完了すると、キーフレーム抽出が自動的に開始されます。
5. キーフレーム抽出後、シーン解析が開始されます（APIキーが設定されている場合）。

### シーンの表示と操作

- **シーンリスト**: 右側のパネルに検出されたシーンのサムネイルが表示されます。
- **シーンの選択**: サムネイルをクリックすると、そのシーンの開始位置に動画がジャンプします。
- **シーン詳細**: サムネイルをダブルクリックすると、シーン詳細ダイアログが表示されます。
  - シーンの詳細情報（開始時間、終了時間、長さ）
  - AIによる解析結果（説明文とタグ）
  - キーフレーム画像

### 静止画の保存場所

シーン検出時に抽出されたキーフレーム（静止画）は以下の場所に保存されます：
```
%USERPROFILE%\.scene_analyzer\keyframes\[セッションID]\scene_[シーン番号].jpg
```
これらの画像ファイルは、シーン詳細ダイアログで表示されるほか、AIによる解析にも使用されます。

### セッション管理

- **セッションの切り替え**: 右上のセッションドロップダウンから過去のセッションを選択できます。
- **新規セッション**: 「ファイル」→「シーン検出セッションを開始...」を選択して新しいセッションを作成します。
- **セッションのエクスポート**: 「ファイル」→「セッションをエクスポート...」を選択してCSVまたはJSONフォーマットでエクスポートします。

## 高度な機能

### データベースの再初期化

問題が発生した場合、「ファイル」→「データベースを再初期化...」を選択してデータベースをリセットできます。この操作は元に戻せないため、必要な場合のみ実行してください。

### プロンプトのカスタマイズ

1. 設定ダイアログの「プロンプト」タブを選択します。
2. 既存のプロンプトを選択するか、新しいプロンプトを作成します。
3. プロンプトの内容を編集して「保存」をクリックします。
4. シーン解析時に使用するプロンプトを選択します。

## トラブルシューティング

### 動画ファイルの互換性

- 動画が読み込めない場合は、ファイル形式がH.264コーデックのMP4（.mp4）であることを確認してください。
- 他の形式の動画ファイルは、サードパーティのツールを使用してH.264 MP4形式に変換してから使用してください。

### APIキーエラー

- APIキーが設定されていない場合、シーン解析時にエラーメッセージが表示されます。
- 設定ダイアログでAPIキーを正しく設定してください。
- APIキーが未設定の状態で解析ボタンを押すと、設定ダイアログを開くオプションが表示されます。
- APIキーはデータベースに安全に保存され、アプリケーション間で共有されます。

### シーン検出の問題

- シーン検出の閾値を調整してみてください。値を下げるとより多くのシーンが検出され、上げると少なくなります。
- 最小シーン長を調整して、短すぎるシーンを除外できます。

### パフォーマンスの問題

- 大きな動画ファイルの処理には時間がかかる場合があります。
- CUDAオプションはGUIに表示されていますが、現在のバージョンでは未実装です。将来のバージョンでサポート予定です。

### アプリケーションが応答しない場合

- 処理中はアプリケーションが一時的に応答しなくなることがあります。
- 処理が完了するまで待つか、停止ボタンをクリックして処理を中断してください。

## サポート

問題が解決しない場合は、以下の情報を添えてサポートにお問い合わせください：

1. 使用しているOSのバージョン
2. 問題が発生した手順
3. エラーメッセージ（表示された場合）
4. ログファイル（`%USERPROFILE%\.scene_analyzer\logs`フォルダ内）

## アンインストール方法

SceneAnalyzerにはアンインストーラーが含まれていません。アプリケーションを削除する場合は、以下の手順に従ってください：

1. アプリケーションの実行ファイルとフォルダを削除します。
2. 以下のデータファイルを手動で削除してください：
   - データベースファイル: `%USERPROFILE%\.scene_analyzer\scene_analyzer.db`
   - キーフレーム画像: `%USERPROFILE%\.scene_analyzer\keyframes\`
   - ログファイル: `%USERPROFILE%\.scene_analyzer\logs\`

これらのファイルを削除しない場合、ディスク上に残り続けます。

## APIキーの管理とエラーハンドリング

SceneAnalyzerでは、Google Gemini APIを使用してシーンの内容を解析します。APIキーの管理とエラーハンドリングについて、以下の点に注意してください。

### APIキーの保存場所

APIキーはSQLiteデータベースに安全に保存されます。データベースファイルは以下の場所に保存されます：
```
%USERPROFILE%\.scene_analyzer\scene_analyzer.db
```

### APIキーが設定されていない場合の動作

1. シーン解析ボタンを押した際にAPIキーが設定されていない場合：
   - エラーメッセージが表示されます。

2. セッション作成時にAPIキーが設定されていない場合：
   - 警告メッセージが表示されます。
   - 後からAPIキーを設定して解析を実行することができます。

### APIキーのセキュリティ

- APIキーはSQLiteデータベースに保存され、アプリケーション内でのみ使用されます。
- アプリケーションのログにはAPIキーの一部のみが表示され、完全なキーは表示されません。
- APIキーを他人と共有したり、公開リポジトリにコミットしたりしないでください。

### APIキーの更新

APIキーを更新する場合は、設定ダイアログから新しいキーを入力して保存してください。更新されたキーはデータベースに保存され、次回の解析から使用されます。

---

© 2025 SceneAnalyzer Team. All rights reserved. 