# シーンアナライザー

PyQt5とWindows MediaFoundationを使用した動画解析アプリケーションです。動画からシーンを自動検出し、Google Gemini APIを使用して各シーンの内容を解析します。

## 主な機能

- **動画再生機能**
  - 動画の再生/一時停止/停止
  - シークスライダーによる再生位置の調整
  - 音量調整
  - 再生速度の変更（0.5x〜2.0x）
  - ドラッグ＆ドロップによる動画ファイルの読み込み

- **シーン検出機能**
  - 動画内の場面転換を自動検出
  - 検出感度の調整
  - 最小シーン長の設定
  - GPUアクセラレーション（CUDA）のUI実装（※現在は機能として動作していません）

- **シーン解析機能**
  - Google Gemini APIを使用した各シーンの内容解析
  - シーンの説明文自動生成
  - キーフレーム抽出と表示

- **セッション管理**
  - 解析結果の保存と読み込み
  - 複数セッションの管理
  - 解析結果のエクスポート（JSON, CSV形式）

- **タイムライン表示**
  - 検出されたシーンのタイムライン表示
  - シーンへの素早いジャンプ機能

## 必要環境

- Python 3.6以上
- PyQt5
- OpenCV
- Google Generative AI Python SDK
- Windows 10/11（MediaFoundationを使用するため）
- Windows Media Feature Pack（Windows N/KN エディションの場合）

## インストール方法

1. リポジトリをクローンまたはダウンロードします。
2. 仮想環境を作成し、有効化します。

```bash
python -m venv .venv
.\.venv\Scripts\activate
```

3. 必要なパッケージをインストールします。

```bash
pip install -r requirements.txt
```

## 使い方

アプリケーションを起動するには、以下のコマンドを実行します。

```bash
python -m scene_analyzer
```

### 動画の読み込み

以下のいずれかの方法で動画ファイルを読み込むことができます。

- メニューから「ファイル」→「開く」を選択
- 動画ファイルをアプリケーションウィンドウにドラッグ＆ドロップ

### シーン検出と解析

1. 動画を読み込んだ後、「セッション開始」ボタンをクリックします。
2. セッション設定ダイアログで必要なパラメータを設定します：
   - シーン検出感度
   - 最小シーン長
   - GPUアクセラレーションの有効/無効（※現在はUIのみ実装で、実際の処理には影響しません）
   - Google Gemini APIキー
3. 「開始」ボタンをクリックすると、シーン検出と解析が開始されます。
4. 検出されたシーンは右側のパネルに表示されます。

### シーン管理

- シーンリストでシーンをクリックすると、そのシーンにジャンプします。
- シーンの説明文は編集不可です。
- キーフレームはサムネイルとして表示されます。

### 解析結果のエクスポート

メニューから「ファイル」→「エクスポート」を選択し、以下の形式でエクスポートできます：

- JSON形式：すべてのシーン情報と解析結果を含む
- CSV形式：シーンのタイムコードと説明文を含む

## APIキーの設定

Google Gemini APIを使用するには、APIキーが必要です。以下の方法で設定できます：

1. 「設定」ダイアログでAPIキーを入力
2. セッション開始時にAPIキーを入力
3. 環境変数として設定（`GEMINI_API_KEY`）

### Google Gemini APIキーの取得方法

1. [Google AI Studio](https://makersuite.google.com/app/apikey)にアクセスします。
2. Googleアカウントでログインします（アカウントがない場合は作成してください）。
3. 「Get API key」または「APIキーを取得」ボタンをクリックします。
4. 新しいAPIキーを作成する場合は「Create API key」または「APIキーを作成」をクリックします。
5. APIキーが生成されるので、コピーして安全な場所に保存してください。
6. このAPIキーをアプリケーションの設定に入力します。

#### 注意事項

- APIキーは秘密情報として扱い、公開リポジトリにコミットしないでください。
- Google Gemini APIは一定の使用量を超えると課金が発生する場合があります。詳細は[Google AIの料金ページ](https://ai.google.dev/pricing)を確認してください。
- 初めて使用する場合は、Google Cloud Platformでの認証が必要になる場合があります。
- APIキーには使用制限があります。詳細は[Google AI Studioのドキュメント](https://ai.google.dev/docs)を参照してください。

## トラブルシューティング

### 動画が再生できない場合

エラーが表示される場合は、以下の対処法を試してください。

1. Windows Media Feature Packがインストールされていることを確認する
   - Windowsの設定 > アプリ > オプション機能 > 機能の追加
   - 「メディア機能」を検索してインストール
   - インストール完了後、システムを再起動

2. サポートされている動画フォーマットを使用する
   - H.264/MP4形式の動画ファイルを使用する
   - 動画ファイルが破損していないことを確認する

3. Windows Updateを実行して最新のMediaFoundationコンポーネントを入手する

### シーン検出が遅い場合

- 動画の解像度を下げる
- シーン検出感度を調整する
- より高性能なCPUを使用する（現在のバージョンではGPUアクセラレーションは実際には機能していません）

### APIキーエラーが表示される場合

- APIキーが正しく入力されているか確認する
- Google Cloud Consoleでキーが有効になっているか確認する
- インターネット接続を確認する

## 開発状況と今後の予定

- **GPUアクセラレーション（CUDA）**: 現在はUIのみ実装されており、実際の処理には影響しません。将来のバージョンで実装予定です。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。詳細は[LICENSE](LICENSE)ファイルを参照してください。 